<head>
 <script src="JQuery/jquery-3.1.0.min.js"></script>
 <script src="spining_wheel.js"></script>
 <script src="JQuery/jQueryRotate.js"></script>
 <link href="css/style.css" rel="stylesheet">
</head>
<body>
  <div>
    <button class = "button" type = 'button' id = "add">+</button>
  </div>


  <div id = 'Form_print' class = "form">
    <ul class = 'taps'>
      <li>Name</li>
      <li>Sample</li>
      <li>Color</li>
    </ul>
    <br>
  </div>

    <canvas id="can" width="400" height="400" />


</body>

<script>
var angle =270;
var velocity = 0;
var print_remove = false;
$('#can').rotate(270);
$('#add').click(function(){
  print_remove = true

$("#Form_print").append(spinning_wheel.print_or_remove(print_remove, null));
});

$("#Form_print").on("click",'#remove', function(){
    //console.log("test");
    print_remove = false
    var removeid = $(this).parent().attr('id');
    //console.log("parent id is  " + removeid);
    var numbercheck = /\d+/g;
    var typecheck = /\D+/g;
    var div_id = removeid.match(numbercheck);
    $("#div_"+div_id[0]).remove();
    spinning_wheel.print_or_remove(print_remove,div_id[0]);
});

$('#can').click(function(){
var output = spinning_wheel.decide_output();
var winner = output[0];
var winner_probability = output[1];
console.log("winner is " + winner);
console.log("should stop at " +winner_probability*360+" degree");
/*************************/
var rotation = setInterval(function(){
        var stop = 360*49+270-8.455;
        velocity = -(1.167983132986*0.000001)*(angle*angle)+(0.0207325)*(angle)+5;
        //angle1 = angle1 + 15*0.001*angle1 +10;
        angle = angle + velocity;
        $('#can').rotate(angle);
       if (angle > stop - 360 * winner_probability) {
         console.log(angle);
         console.log("done");
         clearInterval(rotation);
        angle =0;

       }
  },50);


});

$("#Form_print").on("focus",'input', function(){


    var id = $(this).parent().attr('id');
    var numbercheck = /\d+/g;
    var div_id = id.match(numbercheck);
    //console.log("div_id is " + div_id[0]);

    //console.log("working");
    setInterval(function(){

    live_update_print(div_id[0]);

  }, 50);

});


function live_update_print (id){
  var values = {};
  $.each($('#input_'+id).serializeArray(), function(i, field) {
      values[field.name] = field.value;
  });
  //console.log(values);
/************************* Validation of input**********************************************************/
  if (values.name != "") {
    $("#input_name_check"+id).css("box-shadow","1px 1px 15px green");
    $("#input_name_check"+id).css("border-style","solid");
    $("#input_name_check"+id).css("border-color","green");
    if (values.number_of_sample != "" && values.number_of_sample.match(/^[0-9]+$/) != null) {
      spinning_wheel.print_chart(values, id);
      $("#input_name_check"+id).css("border-style","solid");
      $("#input_sample_check"+id).css("border-style","solid");
      $("#input_sample_check"+id).css("border-color","green");
      $("#input_name_check"+id).css("border-color","green");
      $("#input_sample_check"+id).css("box-shadow","1px 1px 15px green");
      $("#input_name_check"+id).css("box-shadow","1px 1px 15px green");
    }
    else {
      $("#input_sample_check"+id).css("box-shadow","1px 1px 15px red");
      $("#input_sample_check"+id).css("border-color","red");
    }
  }else if (values.number_of_sample == "") {
    $("#input_sample_check"+id).css("box-shadow","1px 1px 10px red");
    $("#input_name_check"+id).css("box-shadow","1px 1px 10px red");
    $("#input_sample_check"+id).css("border-color","red");
    $("#input_name_check"+id).css("border-color","red");
  }
  else {
    $("#input_sample_check"+id).css("box-shadow","1px 1px 15px green");
    $("#input_sample_check"+id).css("border-color","green");
    $("#input_sample_check"+id).css("border-style","solid");
    $("#input_name_check"+id).css("box-shadow","1px 1px 15px red");
  }

}


</script>
